<Window x:Class="FourDTools.Views.CodeDefWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:FourDTools.Converters"
        Title="4D CodeDef Editor"
        Height="520"
        Width="820"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="{DynamicResource WindowBackgroundBrush}"
        FontSize="13"
        WindowStyle="None">

    <!-- Merge the independent theme -->

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/FourDTools;component/Themes/MurphyTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <conv:InvertBoolConverter x:Key="invertBool"/>
        </ResourceDictionary>
    </Window.Resources>


    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="44"/>
            <!-- Title bar (caption) -->
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="*"/>
            <!-- DataGrid -->
            <RowDefinition Height="Auto"/>
            <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- ====================== -->
        <!-- Title bar (Murphy green) -->
        <!-- ====================== -->

        <Border Grid.Row="0" Background="{StaticResource MurphyGreenBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Drag area -->
                <Border Background="Transparent"
                        MouseLeftButtonDown="TitleBar_OnMouseLeftButtonDown">
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="12,0,0,0">
                        <TextBlock Text="4D CodeDef Editor"
                                   Style="{StaticResource TitleText}"/>
                    </StackPanel>
                </Border>

                <!-- Minimize + Close buttons -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">

                    <Button Style="{StaticResource ChromeButton}"
                            Click="MinButton_OnClick">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE921;" />
                        <!-- Minimize -->
                    </Button>

                    <Button Style="{StaticResource ChromeButton}"
                            Click="CloseButton_OnClick">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE8BB;" />
                        <!-- Close -->
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ====================== -->
        <!-- Toolbar                 -->
        <!-- ====================== -->
        <StackPanel Orientation="Horizontal"
                    Grid.Row="1"
                    Margin="12,12,12,8">

            <!-- Reload -->
            <Button Style="{StaticResource PrimaryButton}"
                    Command="{Binding CmdReloadSelection}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72C;" Margin="0,0,6,0"/>
                    <!-- Refresh -->
                    <TextBlock Text="Reload Selection"/>
                </StackPanel>
            </Button>

            <!-- Prev -->
            <Button Style="{StaticResource PrimaryButton}"
                    Command="{Binding CmdPrev}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE0A6;" Margin="0,0,6,0"/>
                    <!-- Back -->
                    <TextBlock Text="Prev"/>
                </StackPanel>
            </Button>

            <!-- Next -->
            <Button Style="{StaticResource PrimaryButton}"
                    Command="{Binding CmdNext}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE0AB;" Margin="0,0,6,0"/>
                    <!-- Forward -->
                    <TextBlock Text="Next"/>
                </StackPanel>
            </Button>

            <!-- Save Current -->
            <Button Style="{StaticResource PrimaryButton}"
                    Command="{Binding CmdSaveCurrent}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE105;" Margin="0,0,6,0"/>
                    <!-- Save -->
                    <TextBlock Text="Save Current"/>
                </StackPanel>
            </Button>

            <!-- Save All -->
            <Button Style="{StaticResource PrimaryButton}"
                    Command="{Binding CmdSaveAll}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE149;" Margin="0,0,6,0"/>
                    <!-- SaveAll / SaveAs glyph -->
                    <TextBlock Text="Save All (Host only)"/>
                </StackPanel>
            </Button>

            <!-- Close -->
            <Button Style="{StaticResource SecondaryButton}"
                    Command="{Binding CmdClose}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8BB;" Margin="0,0,6,0"/>
                    <!-- Close -->
                    <TextBlock Text="Close"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- ====================== -->
        <!-- DataGrid                -->
        <!-- ====================== -->
        <DataGrid Grid.Row="2"
                  Margin="12,0,12,0"
                  ItemsSource="{Binding Items}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  SelectionMode="Single"
                  SelectedIndex="{Binding CurrentIndex, Mode=TwoWay}">

            <DataGrid.Columns>

                <DataGridTextColumn Header="Handle"
                                    Binding="{Binding Handle}"
                                    IsReadOnly="True"
                                    Width="100"/>

                <DataGridTextColumn Header="XREF?"
                                    Binding="{Binding IsInXref}"
                                    IsReadOnly="True"
                                    Width="60"/>

                <DataGridComboBoxColumn Header="4D_Code_Type"
                                        Width="150"
                                        SelectedItemBinding="{Binding CodeType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.AllowedTypes, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            <Setter Property="IsEnabled"
                                    Value="{Binding IsInXref, Converter={StaticResource invertBool}}"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.AllowedTypes, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            <Setter Property="IsEditable" Value="False"/>
                            <Setter Property="IsEnabled"
                                    Value="{Binding IsInXref, Converter={StaticResource invertBool}}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>

                <DataGridTextColumn Header="4D_Code_Value"
                                    Width="*"
                                    Binding="{Binding CodeValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground"
                                    Value="{Binding IsInXref,
                                            Converter={StaticResource invertBool},
                                            ConverterParameter=disabled}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style TargetType="TextBox">
                            <Setter Property="IsReadOnly" Value="{Binding IsInXref}"/>
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Dirty"
                                    Binding="{Binding IsDirty}"
                                    IsReadOnly="True"
                                    Width="60"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- ====================== -->
        <!-- Footer tip              -->
        <!-- ====================== -->
        <Border Grid.Row="3" Margin="12,8,12,12" Background="{StaticResource SurfaceWhiteBrush}" Padding="8" BorderBrush="{StaticResource NeutralBorderBrush}" BorderThickness="1">
            <TextBlock Text="Tip: XREF rows are read-only here. Open the XREF DWG to edit their XData."
                       Foreground="{StaticResource NeutralMidBrush}"/>
        </Border>

    </Grid>
</Window>